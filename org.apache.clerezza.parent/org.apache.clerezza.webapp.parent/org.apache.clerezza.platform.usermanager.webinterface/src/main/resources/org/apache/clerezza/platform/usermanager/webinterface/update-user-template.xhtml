def foaf(s: Any) = new UriRef("http://xmlns.com/foaf/0.1/" + s)
def osgi(s: Any) = new UriRef("http://clerezza.org/2008/11/osgi#" + s)
def permission(s: Any) = new UriRef("http://clerezza.org/2008/10/permission#" + s)
def sioc(s: Any) = new UriRef("http://rdfs.org/sioc/ns#" + s)
def dc(s: Any) = new UriRef("http://purl.org/dc/elements/1.1/" + s)
def umr(s: Any) = new UriRef("http://clerezza.org/2009/05/usermanager#" + s)
def platform(s: Any) = new UriRef("http://clerezza.org/2009/08/platform#" + s)

resultDocModifier.addScriptReference("js/usermanager.js");

resultDocModifier.setTitle("User Manager");
resultDocModifier.addNodes2Elem("tx-module", <h1>User Manager</h1>);

resultDocModifier.addNodes2Elem("tx-module-tabs-ol", <li class="tx-active"><a href="#">Users</a></li>);
resultDocModifier.addNodes2Elem("tx-module-tabs-ol", <li><a href="list-roles">Roles</a></li>);

resultDocModifier.addNodes2Elem("tx-contextual-buttons-ol", <li><a id="deleteButton" class="tx-button tx-button-remove" href="list-users">Cancel</a></li>);
resultDocModifier.addNodes2Elem("tx-contextual-buttons-ol", <li><a id="addButton" class="tx-button tx-button-create" href="#">Save</a></li>);

        <div id="tx-content">
			<script type="text/javascript">
				var userRoles = new Array();
				{var titles = "";
					for (user <- (res/umr("user"))) yield {
						for (funct <- (user/sioc("has_function"))) yield {
							"userRoles.push('" + {funct/dc("title")*} +"');"
						}
				}
				}

				$(document).ready(function() {{
					$('#userRoles').val(userRoles);
					
					refreshCustomInformation({"'" + (res/umr("user")/platform("userName")*) + "'"});

					 $("#userRoles option").each(function() {{
						$(this).bind("click", function() {{
							refreshCustomInformation({"'" + (res/umr("user")/platform("userName")*)  + "'"});
						}});
					 }});
				}});

				var multiplefield = new Array();
			</script> 
            
            <div id="tx-list">
                <form id="userform" name="userform" action="update-user" method="post" style="width:600px; float:left; margin-right:50px; text-align:right" enctype="multipart/form-data">
                <div style="float:left; width:300px;">
                    <fieldset border="1px">	
                        <legend>Basic User Information</legend>
                        <label>Username: <input name="userName" type="text" value={res/umr("user")/platform("userName")*}/></label><br />
                        <label>Email: <input name="email" type="text" value={res/umr("user")/foaf("mbox")*}/></label><br />
                        <label>Path Prefix: <input name="pathPrefix" type="text" value={res/umr("user")/osgi("agent_path_prefix")*} /></label><br />
                        <label>User Roles: 
                            <select name="userRoles" id="userRoles" size="3" multiple="multiple">
                                {for (role <- (res/umr("role"))) yield {
                                    <option value={role/dc("title")*}>{role/dc("title")*}</option>
                                }
								}
                            </select>
                        </label><br /><br />
                    </fieldset> 
                </div>
                <div id="custominfos" style="float:right;  width:250px;"></div>
                </form>
            </div>
        </div>
